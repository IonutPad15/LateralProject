@using Models.Response

@using System.Text.Json
@{
    ViewData["Title"] = "Home Page";
    
}
@if(Context.Request.Cookies["token3"]!= null)
{
<div class="row">
    <div class="col-md-10">
        <form asp-controller="Home" asp-action="CreatePost">
        <div class="input-group">
            <div class="col-md-2">
            <input type="text" placeholder='(Title)' name="postTitle" class="form-control" required >
            </div>
            <div class="col-md-8">
            <input type="text" placeholder='(Post-Body)' name="postBody" class="form-control" required >
            </div>
            <span class="input-group-btn">
                <input type="submit" value="Create Post" class="btn btn-primary" />
            </span>
        </div>
        <div class="form-group">
            @Html.Label((string)ViewBag.ErrorUser)     
        </div>
        </form>
    </div>
</div>
}
@{
    @model IEnumerable<PostInfo>
    <table class="table">
    <tr>
        <th>
            Votes
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Author)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Title)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Description)
        </th>
            <th>
            @Html.Label("Comments:")
        </th>
    </tr>
    @foreach(var item in Model)
{
    <tr>
    <td>
        <div class="col-2">
        @{
            var token = Context.Request.Cookies["token3"];
            if (token != null)
            {
                <form asp-controller="User" asp-action="UpVote">

                    <div class="form-group">
                        <input class="form-control" name="postId" value=@item.Id hidden />
                    </div>
                    <div class="form-group">
                        <input type ="submit" class="btn-outline-primary" value= &#8679;
                                    style="font-size:22px"  >
                    </div>
                </form>
            }
            <div>
                                    @Html.DisplayFor(modelItem=> @item.Votes)
            </div>
            if (token != null)
            {
                <form asp-controller="User" asp-action="DownVote">

                    <div class="form-group">
                        <input class="form-control" name="postId" value=@item.Id hidden />
                    </div>
                    <div class="form-group">
                        <input type ="submit" class="btn-outline-danger" value= &#8681;
                                    style="font-size:22px"   >
                    </div>
                </form>
            }
        }
        </div>
    </td>
    <td>
        @if(!item.Author.Equals("[User Deleted]"))
        {
                    @Html.ActionLink($"{item.Author}","AboutUser","User",new{
                @id = @item.UserId}, null)
                        
        }
        else
        {
            @Html.DisplayFor(modelItem =>item.Author)
        }
    </td>
    <td>
        @Html.DisplayFor(modelItem =>item.Title)
    </td>
    <td>
        @Html.DisplayFor(modelItem =>item.Description)
    </td>            
    <td> 
        @Html.ActionLink($"{item.Comments.Count}","CommentsByPostId","Comment",new{
            @id = @item.Id}, null)
    </td>
    <td>
                                       
    @{
         token = Context.Request.Cookies["token3"];
        @if(token != null && @item.UserId != null)
        {
            var jsonSerializerOptions = new JsonSerializerOptions() { PropertyNameCaseInsensitive = true };
            var responseToken = JsonSerializer.Deserialize<UserToken>(
                token, jsonSerializerOptions);
            @if(responseToken!= null && responseToken.UserId == @item.UserId)
            {
                <div>
                    @Html.ActionLink("Edit", "Edit", new { @id = @item.Id,@body=@item.Description}) |
                    @Html.ActionLink("Delete", "Delete", new { @id = @item.Id,@body= @item.Description })
                </div>
            }
        }
    }
    </td>
    </tr>  
    }                       
    </table>
}

