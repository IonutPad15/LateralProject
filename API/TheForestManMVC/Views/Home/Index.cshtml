@using Models.Response

@using System.Text.Json
@{
    ViewData["Title"] = "Home Page";
    
}
@if(Context.Request.Cookies["token3"]!= null)
{
<div class="row">
    <div class="col-md-10">
        <form asp-controller="Home" asp-action="CreatePost">
        <div class="input-group">
            <div class="col-md-2">
            <input type="text" placeholder='(Title)' name="postTitle" class="form-control" required >
            </div>
            <div class="col-md-8">
            <input type="text" placeholder='(Post-Body)' name="postBody" class="form-control" required >
            </div>
            <span class="input-group-btn">
                <input type="submit" value="Create Post" class="btn btn-primary" />
            </span>
        </div>
        <div class="form-group">
            @Html.Label((string)ViewBag.ErrorUser)     
        </div>
        </form>
    </div>
</div>
}
@{
@model IEnumerable<PostInfo>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Author)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Title)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Body)
        </th>
            <th>
            @Html.Label("Comments:")
        </th>
    </tr>
    @foreach(var item in Model)
    {
    <tr>
        <td>
            @if(!item.Author.Equals("[User Deleted]"))
        {
                @Html.ActionLink($"{item.Author}","AboutUser","User",new{
                @id = @item.UserId}, null)
                        
        }
        else
        {
                @Html.DisplayFor(modelItem =>item.Author)
        }
        </td>
        <td>
            @Html.DisplayFor(modelItem =>item.Title)
        </td>
        <td>
            @Html.DisplayFor(modelItem =>item.Body)
        </td>            
        <td> 
            @Html.ActionLink($"{item.Comments.Count}","CommentsByPostId","Comment",new{
            @id = @item.Id}, null)
        </td>
        <td>
               
        @{
        var token = Context.Request.Cookies["token3"];
        @if(token != null && @item.UserId != null)
        {
            var jsonSerializerOptions = new JsonSerializerOptions() { PropertyNameCaseInsensitive = true };
            var responseToken = JsonSerializer.Deserialize<UserToken>(
                token, jsonSerializerOptions);
            @if(responseToken.UserId == @item.UserId)
            {
                <div>
                    @Html.ActionLink("Edit", "Edit", new { @id = @item.Id,@body=@item.Body}) |
                    @Html.ActionLink("Delete", "Delete", new { @id = @item.Id,@body= @item.Body })
                </div>
            }
        }
        }
        </td>
    </tr>  
    }                       
</table>
}

